{% extends 'base.html' %}
{% load static %}

{% block extra_head %}
  <link rel="stylesheet" href="{% static 'styles/turnos.css' %}">
{% endblock %}

{% block content %}
<div id="turnos-anchor"></div>

<div class="shifts-app">
 <header class="shifts-topbar">
  <nav class="shifts-tabs" id="areaTabs">
    <a href="{% url 'turnos_extrusion' %}" data-area="Extrusión"
       class="{% if request.resolver_match.url_name == 'turnos_extrusion' %}active{% endif %}">Extrusión</a>
    <a href="{% url 'turnos_mezclado' %}" data-area="Mezclado"
       class="{% if request.resolver_match.url_name == 'turnos_mezclado' %}active{% endif %}">Mezclado</a>
    <a href="{% url 'turnos_laminado' %}" data-area="Laminado"
       class="{% if request.resolver_match.url_name == 'turnos_laminado' %}active{% endif %}">Laminado</a>
    <a href="{% url 'turnos_impresion' %}" data-area="Impresión"
       class="{% if request.resolver_match.url_name == 'turnos_impresion' %}active{% endif %}">Impresión</a>
    <a href="{% url 'turnos_sellado' %}" data-area="Sellado"
       class="{% if request.resolver_match.url_name == 'turnos_sellado' %}active{% endif %}">Sellado</a>
    <a href="{% url 'turnos_corte' %}" data-area="Corte"
       class="{% if request.resolver_match.url_name == 'turnos_corte' %}active{% endif %}">Corte</a>
  </nav>

  <!-- Título centrado -->
  <div class="shifts-title">
    <span id="rangeTitle"></span>
  </div>

  <!-- Controles de rango -->
    <!-- CONTROLES NUEVOS (rango + exportar) -->
    <div class="shifts-controls" id="controls-range">
      <label>Desde <input type="date" id="fromDate"></label>
      <label>Hasta <input type="date" id="toDate"></label>
      <button id="btnApplyRange" class="btn-outline" type="button">Aplicar</button>
      <button id="btnExportPdf" class="btn" type="button">Exportar</button>
    </div>
  </header>

  <div class="shifts-body">
    <!-- Sidebar de operadores -->
    <aside class="operators">
      <div class="operators-head"><h3>Operadores</h3></div>
      <div class="operators-search">
        <input type="text" id="opSearch" placeholder="Buscar operador…">
      </div>
      <ul id="opList" class="operators-list"></ul>
    </aside>

    <!-- Grid: 3 turnos + ausencias -->
    <main class="shifts-grid" id="grid">
      {% for shift in "123" %}
      <section class="shift-col" data-shift="{{ forloop.counter }}">
        <header>
          <h4>
            Turno {{ forloop.counter }} — 
            {% if forloop.counter == 1 %}Mañana 7:00 a 15:00{% elif forloop.counter == 2 %}Tarde 14:00 a 22:00 {% else %}Noche 22:00 a 7:00 {% endif %}
          </h4>
        </header>

        <div class="shift-container">
          {# ==== AQUÍ VA EL LOOP DE SECCIONES ==== #}
          {% for s in sections %}
          <div class="slot-section">
            <div class="slot-title">
              {{ s.title }} <span class="slot-cap">0/{{ s.cap }}</span>
            </div>
            <ul class="slot"
                data-area="{{ s.key }}"
                data-capacity="{{ s.cap }}"
                data-shift="{{ forloop.parentloop.counter }}">
            </ul>
          </div>
          {% endfor %}
        </div>
      </section>
      {% endfor %}

      <!-- Columna de Ausencias -->
      <section class="shift-col absences-col">
        <header><h4>Ausencias del día</h4></header>
        <div class="shift-container">
          <div class="absence-box">
            <h5>Compensados</h5>
            <ul class="absence-drop" data-absence="compensados"></ul>
          </div>
          <div class="absence-box">
            <h5>Licencias</h5>
            <ul class="absence-drop" data-absence="licencias"></ul>
          </div>
          <div class="absence-box">
            <h5>Vacaciones</h5>
            <ul class="absence-drop" data-absence="vacaciones"></ul>
          </div>
        </div>
      </section>
    </main>
  </div>
</div>
{% endblock %}

{% block extra_js %}
  <script src="{% static 'js/shifts.js' %}" defer></script>
{% endblock %}
