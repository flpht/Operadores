<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <title>Turnos {{ area }}</title>
</head>
<body>
  <h1>Turnos planta {{ area }}</h1>
  <h2 class="muted">{{ semana_txt }}{% if rango_txt %} ({{ rango_txt }}){% endif %}</h2>

  <table class="meta">
    <tr>
      <td><strong>Área</strong></td><td>{{ area }}</td>
      <td><strong>Rango</strong></td><td>{{ rango_txt }}</td>
      <td><strong>Semana</strong></td><td>{{ semana_txt }}</td>
    </tr>
  </table>

  {% with shifts=data.shifts abs=data.absences %}
  <div class="grid">
    {% for shift_num, shift_data in shifts.items %}
      <div class="col">
        <h3>
          Turno {{ shift_num }}
          {% if shift_num == "1" %}— Mañana{% elif shift_num == "2" %}— Tarde{% else %}— Noche{% endif %}
        </h3>

        {% for section_key, section_info in shift_data.sections.items %}
          <div class="section">
            <div class="section-title">
              <span>{{ section_key|upper }}</span>
              <span class="muted">{{ section_info.ops|length }}/{{ section_info.cap }}</span>
            </div>
            <div>
              {% for op_id in section_info.ops %}
                {% with opid=op_id|stringformat:"s" %}
                  <span class="pill">
                    {{ operators.opid|default:op_id }}
                  </span>
                {% endwith %}
              {% empty %}
                <span class="muted">— Sin asignaciones —</span>
              {% endfor %}
            </div>
          </div>
        {% endfor %}

        <div class="abs">
          <h4>Ausencias</h4>
          <div>
            {% for ab_key, ids in abs.items %}
              {% if ids %}
                <div class="section">
                  <div class="section-title"><span>{{ ab_key|title }}</span></div>
                  {% for op_id in ids %}
                    {% with opid=op_id|stringformat:"s" %}
                      <span class="pill">{{ operators.opid|default:op_id }}</span>
                    {% endwith %}
                  {% endfor %}
                </div>
              {% endif %}
            {% endfor %}
          </div>
        </div>
      </div>
    {% endfor %}
  </div>
  {% endwith %}
</body>
</html>
