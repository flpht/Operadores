<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <title>Turnos {{ area }} — Semana {{ week_number }}</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <style>
    /* Página A4 apaisado con márgenes moderados */
    @page { size: A4 landscape; margin: 12mm; }

    html, body {
      font-family: Arial, Helvetica, sans-serif;
      font-size: 11.5px;
      color: #111827;
      line-height: 1.35;
    }

    /* Cabecera normal (no fixed) */
    .head {
      margin-bottom: 10px;
      border-bottom: 1px solid #e5e7eb;
      padding-bottom: 6px;
    }
    .title {
      font-size: 18px; font-weight: 700; margin: 0 0 2px 0;
    }
    .sub { color:#6b7280; font-size: 11px; }
    .chips { margin-top: 6px; }
    .chip {
      display:inline-block; padding: 2px 8px; border-radius:999px;
      font-size:10px; background:#e8f5ee; color:#065f46; border:1px solid #bbf7d0;
      margin-right:6px;
    }

    /* Tabla principal */
    table { width: 100%; border-collapse: collapse; table-layout: fixed; }
    thead th {
      text-align: left; background:#f9fafb; border:1px solid #e5e7eb; padding:8px;
      font-weight:700;
    }
    tbody td {
      border:1px solid #e5e7eb; padding:8px; vertical-align: top;
      /* evitar cortes feos por fila en wkhtmltopdf */
      page-break-inside: avoid;
    }

    /* Anchos */
    .c-puesto { width: 30%; }
    .c-t1, .c-t2, .c-t3 { width: 23.3%; }

    .puesto { font-weight: 700; margin-bottom: 2px; }
    .cap { color:#6b7280; font-size:10px; margin-top: 2px; }

    ul { margin: 4px 0 0 16px; padding: 0; }
    li { margin: 1px 0; }
    .tight li { margin: 0; }
    .empty { color:#9ca3af; font-style: italic; }

    /* zebra suave */
    tbody tr:nth-child(odd) td { background:#fcfcfd; }

    /* Pie simple */
    .foot {
      margin-top: 8px; text-align:center; color:#9ca3af; font-size:10px;
      border-top:1px solid #f3f4f6; padding-top:4px;
    }
  </style>
</head>
<body>

  <div class="head">
    <div class="title">
      Turnos planta {{ area }} — Semana N° {{ week_number }}
      (del {{ from_label }} al {{ to_label }})
    </div>
    <div class="sub">
      Rango: {{ from_label }} – {{ to_label }} • Semana ISO: {{ week_number }}
      {% if generated_at %} • Generado: {{ generated_at }}{% endif %}
    </div>
    <div class="chips">
      <span class="chip">Mañana 07:00–15:00</span>
      <span class="chip">Tarde 14:00–22:00</span>
      <span class="chip">Noche 22:00–07:00</span>
    </div>
  </div>

  <table>
    <thead>
      <tr>
        <th class="c-puesto">Puesto / Sección</th>
        <th class="c-t1">Turno 1 — Mañana</th>
        <th class="c-t2">Turno 2 — Tarde</th>
        <th class="c-t3">Turno 3 — Noche</th>
      </tr>
    </thead>

    <tbody>
      {# Caso 1: viene roles armado desde la vista #}
      {% if roles and roles|length %}
        {% for r in roles %}
        <tr>
          <td>
            <div class="puesto">{{ r.title }}</div>
            <div class="cap">
              Cap.: {{ r.cap1|default:r.cap|default:0 }}/T1 ·
              {{ r.cap2|default:r.cap|default:0 }}/T2 ·
              {{ r.cap3|default:r.cap|default:0 }}/T3
            </div>
          </td>

          <td>
            {% if r.t1 and r.t1|length %}
              <ul class="{% if r.t1|length > 8 %}tight{% endif %}">
                {% for n in r.t1 %}<li>{{ n }}</li>{% endfor %}
              </ul>
            {% else %}<span class="empty">—</span>{% endif %}
          </td>

          <td>
            {% if r.t2 and r.t2|length %}
              <ul class="{% if r.t2|length > 8 %}tight{% endif %}">
                {% for n in r.t2 %}<li>{{ n }}</li>{% endfor %}
              </ul>
            {% else %}<span class="empty">—</span>{% endif %}
          </td>

          <td>
            {% if r.t3 and r.t3|length %}
              <ul class="{% if r.t3|length > 8 %}tight{% endif %}">
                {% for n in r.t3 %}<li>{{ n }}</li>{% endfor %}
              </ul>
            {% else %}<span class="empty">—</span>{% endif %}
          </td>
        </tr>
        {% endfor %}

      {# Caso 2: fallback si la vista no armó roles, usamos sections (solo títulos/cap) #}
      {% else %}
        {% for s in sections %}
        <tr>
          <td>
            <div class="puesto">{{ s.title }}</div>
            <div class="cap">
              Cap.: {{ s.cap }}/T1 · {{ s.cap }}/T2 · {{ s.cap }}/T3
            </div>
          </td>
          <td><span class="empty">—</span></td>
          <td><span class="empty">—</span></td>
          <td><span class="empty">—</span></td>
        </tr>
        {% endfor %}
      {% endif %}
    </tbody>
  </table>

  <div class="foot">
    Gestor de Operadores — {{ area }}
  </div>
</body>
</html>
